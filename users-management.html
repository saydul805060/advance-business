<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ইউজার ম্যানেজমেন্ট - Advance Business</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap CSS for Modal -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Admin Check */
        .admin-check-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .admin-check-message {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .admin-check-message h2 {
            color: #dc3545;
            margin-bottom: 15px;
        }
        
        .admin-check-message button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1 i {
            color: #ffd700;
        }
        
        .stats-container {
            display: flex;
            gap: 20px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stat-box:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .stat-label {
            font-size: 12px;
            margin-top: 5px;
        }
        
        /* Tabs */
        .tabs-container {
            background: #f8f9fa;
            padding: 0 30px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            padding-top: 15px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: #e9ecef;
            border: none;
            border-radius: 8px 8px 0 0;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: #dee2e6;
        }
        
        .tab-btn.active {
            background: white;
            color: #ff8c00;
            border-bottom: 3px solid #ff8c00;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Search Box */
        .search-container {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .search-box {
            position: relative;
            max-width: 400px;
            margin-bottom: 10px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #ff8c00;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #ff8c00;
        }
        
        /* User Table */
        .user-table-container {
            padding: 20px;
            overflow-x: auto;
        }
        
        .user-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .user-table th {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            border: none;
            position: sticky;
            top: 0;
        }
        
        .user-table th:first-child {
            border-radius: 10px 0 0 0;
        }
        
        .user-table th:last-child {
            border-radius: 0 10px 0 0;
        }
        
        .user-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        
        .user-table tr:hover {
            background: #fff9f0;
        }
        
        .user-table tr.selected {
            background: linear-gradient(to right, rgba(255, 140, 0, 0.1), rgba(255, 140, 0, 0.05));
        }
        
        /* Hash Column */
        .hash-tag {
            display: inline-block;
            background: #ff8c00;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* User Info Cells */
        .user-info-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .user-info-label {
            font-size: 11px;
            color: #666;
            font-weight: 500;
        }
        
        .user-info-value {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-blocked {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 85px;
            justify-content: center;
            white-space: nowrap;
        }
        
        .action-btn i {
            font-size: 14px;
        }
        
        .ban-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }
        
        .ban-btn:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(220, 53, 69, 0.3);
        }
        
        .view-btn {
            background: linear-gradient(135deg, #007bff, #0069d9);
            color: white;
        }
        
        .view-btn:hover {
            background: linear-gradient(135deg, #0069d9, #0056b3);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 123, 255, 0.3);
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #28a745, #218838);
            color: white;
        }
        
        .edit-btn:hover {
            background: linear-gradient(135deg, #218838, #1e7e34);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(40, 167, 69, 0.3);
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }
        
        .delete-btn:hover {
            background: linear-gradient(135deg, #545b62, #4a5056);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(108, 117, 125, 0.3);
        }
        
        /* Filter Options */
        .filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            border-color: #ff8c00;
            color: #ff8c00;
        }
        
        .filter-btn.active {
            background: #ff8c00;
            color: white;
            border-color: #ff8c00;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 0 0 15px 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-input-group {
            margin-bottom: 20px;
        }
        
        .modal-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .modal-input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .modal-input-group input:focus {
            outline: none;
            border-color: #ff8c00;
        }
        
        /* Ban Days Input */
        .ban-days-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }
        
        .ban-days-input input {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
        
        /* User Details View */
        .user-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .user-detail-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff8c00;
        }
        
        .user-detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .user-detail-value {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        /* Block Timer */
        .block-timer {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #dc3545;
            margin-top: 5px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .user-table-container {
                overflow-x: scroll;
            }
            
            .user-table {
                min-width: 1200px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats-container {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .stat-box {
                min-width: 100px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .search-container {
                padding: 15px;
            }
            
            .user-details-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                justify-content: center;
            }
        }
        
        /* No Data Message */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .no-data i {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .no-data h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #ff8c00;
        }
        
        .loading-spinner i {
            font-size: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Analytics Cards */
        .analytics-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .analytics-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .analytics-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .analytics-label {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Admin Check Overlay -->
    <div class="admin-check-overlay" id="adminCheckOverlay">
        <div class="admin-check-message">
            <h2><i class="fas fa-exclamation-triangle"></i> অ্যাক্সেস ডিনাইড!</h2>
            <p>এই পেজ শুধুমাত্র এডমিনদের জন্য। ইউজার ড্যাশবোর্ডে যেতে লগইন করুন।</p>
            <button onclick="goToDashboard()">ইউজার ড্যাশবোর্ডে যান</button>
            <button onclick="goToLogin()" style="background: #6c757d; margin-left: 10px;">লগইন পেজে যান</button>
        </div>
    </div>
    
    <!-- Ban Modal -->
    <div class="modal-overlay" id="banModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-ban"></i> ইউজার ব্লক করুন</h3>
                <button class="modal-close" onclick="closeModal('banModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-input-group">
                    <label>ইউজারনেম</label>
                    <input type="text" id="banUsername" readonly>
                </div>
                <div class="modal-input-group">
                    <label>ব্যবহারকারীর নাম</label>
                    <input type="text" id="banUserName" readonly>
                </div>
                <div class="modal-input-group">
                    <label>ব্লকের কারণ</label>
                    <input type="text" id="banReason" placeholder="ব্লক করার কারণ লিখুন">
                </div>
                <div class="ban-days-input">
                    <label>ব্লকের সময়:</label>
                    <input type="number" id="banDays" min="1" max="365" value="7">
                    <span>দিন</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" style="background: #6c757d;" onclick="closeModal('banModal')">বাতিল</button>
                <button class="action-btn ban-btn" onclick="confirmBan()">ব্লক করুন</button>
            </div>
        </div>
    </div>
    
    <!-- View User Modal -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> ইউজার ডিটেলস</h3>
                <button class="modal-close" onclick="closeModal('viewModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="user-details-grid" id="userDetailsGrid">
                    <!-- User details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" style="background: #6c757d;" onclick="closeModal('viewModal')">বন্ধ করুন</button>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ইউজার এডিট করুন</h3>
                <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-input-group">
                    <label>পুরো নাম</label>
                    <input type="text" id="editName">
                </div>
                <div class="modal-input-group">
                    <label>ইউজারনেম</label>
                    <input type="text" id="editUsername" readonly>
                </div>
                <div class="modal-input-group">
                    <label>মোবাইল নম্বর</label>
                    <input type="tel" id="editPhone">
                </div>
                <div class="modal-input-group">
                    <label>ইমেইল</label>
                    <input type="email" id="editEmail">
                </div>
                <div class="modal-input-group">
                    <label>পাসওয়ার্ড</label>
                    <input type="text" id="editPassword">
                </div>
                <div class="modal-input-group">
                    <label>ব্যালেন্স (টাকা)</label>
                    <input type="number" id="editBalance" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" style="background: #6c757d;" onclick="closeModal('editModal')">বাতিল</button>
                <button class="action-btn edit-btn" onclick="confirmEdit()">সেভ করুন</button>
            </div>
        </div>
    </div>
    
    <!-- Delete User Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header" style="background: #dc3545;">
                <h3><i class="fas fa-trash-alt"></i> ইউজার ডিলিট করুন</h3>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center; font-size: 16px; margin-bottom: 20px;">
                    আপনি কি নিশ্চিত যে এই ইউজারকে ডিলিট করতে চান?
                </p>
                <div class="modal-input-group">
                    <label>ইউজারনেম</label>
                    <input type="text" id="deleteUsername" readonly>
                </div>
                <div class="modal-input-group">
                    <label>ব্যবহারকারীর নাম</label>
                    <input type="text" id="deleteUserName" readonly>
                </div>
                <div class="modal-input-group">
                    <label>ডিলিট করার কারণ</label>
                    <input type="text" id="deleteReason" placeholder="ডিলিট করার কারণ লিখুন">
                </div>
                <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>সতর্কতা:</strong> এই একশন রিভার্স করা যাবে না! ইউজারের সব তথ্য স্থায়ীভাবে মুছে যাবে।
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" style="background: #6c757d;" onclick="closeModal('deleteModal')">বাতিল</button>
                <button class="action-btn delete-btn" onclick="confirmDelete()">ডিলিট করুন</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-users-cog"></i>
                ইউজার ম্যানেজমেন্ট সিস্টেম
            </h1>
            <div class="stats-container">
                <div class="stat-box" onclick="switchTab('users')">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">মোট ইউজার</div>
                </div>
                <div class="stat-box" onclick="switchTab('users')">
                    <div class="stat-value" id="activeUsers">0</div>
                    <div class="stat-label">অ্যাক্টিভ</div>
                </div>
                <div class="stat-box" onclick="switchTab('users')">
                    <div class="stat-value" id="blockedUsers">0</div>
                    <div class="stat-label">ব্লকড</div>
                </div>
                <div class="stat-box" onclick="switchTab('users')">
                    <div class="stat-value" id="totalIncome">৳0</div>
                    <div class="stat-label">মোট ইনকাম</div>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="users">
                    <i class="fas fa-users"></i> ইউজার লিস্ট
                </button>
                <button class="tab-btn" data-tab="blocked">
                    <i class="fas fa-ban"></i> ব্লকড ইউজার
                </button>
                <button class="tab-btn" data-tab="analytics">
                    <i class="fas fa-chart-line"></i> অ্যানালাইটিক্স
                </button>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div class="tab-content active" id="users-tab">
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="ইউজার সার্চ করুন...">
                </div>
                
                <div class="filter-options">
                    <button class="filter-btn active" data-filter="all">সব ইউজার</button>
                    <button class="filter-btn" data-filter="active">অ্যাক্টিভ</button>
                    <button class="filter-btn" data-filter="today">আজ যুক্ত</button>
                    <button class="filter-btn" data-filter="income">টপ ইনকাম</button>
                </div>
            </div>
            
            <div class="user-table-container">
                <table class="user-table" id="userTable">
                    <thead>
                        <tr>
                            <th style="width: 60px;">#</th>
                            <th style="width: 180px;">ব্যক্তিগত তথ্য</th>
                            <th style="width: 120px;">ইউজারনেম</th>
                            <th style="width: 150px;">মোবাইল</th>
                            <th style="width: 200px;">ইমেইল</th>
                            <th style="width: 120px;">জয়েন ডেট</th>
                            <th style="width: 100px;">ব্যালেন্স</th>
                            <th style="width: 100px;">স্ট্যাটাস</th>
                            <th style="width: 380px;">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <!-- User rows will be loaded here -->
                    </tbody>
                </table>
                
                <div id="loadingUsers" class="loading-spinner">
                    <i class="fas fa-spinner"></i>
                    <p>ইউজার লোড হচ্ছে...</p>
                </div>
                
                <div id="noUsersMessage" class="no-data" style="display: none;">
                    <i class="fas fa-user-slash"></i>
                    <h3>কোনো ইউজার পাওয়া যায়নি</h3>
                    <p>ইউজার ডাটাবেস খালি আছে</p>
                </div>
            </div>
        </div>
        
        <!-- Blocked Users Tab -->
        <div class="tab-content" id="blocked-tab">
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="blockedSearch" placeholder="ব্লকড ইউজার সার্চ করুন...">
                </div>
            </div>
            
            <div class="user-table-container">
                <table class="user-table" id="blockedTable">
                    <thead>
                        <tr>
                            <th style="width: 60px;">#</th>
                            <th style="width: 150px;">ব্যবহারকারী</th>
                            <th style="width: 120px;">ইউজারনেম</th>
                            <th style="width: 150px;">মোবাইল</th>
                            <th style="width: 150px;">ব্লক তারিখ</th>
                            <th style="width: 150px;">ব্লক মেয়াদ</th>
                            <th style="width: 200px;">কারণ</th>
                            <th style="width: 200px;">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="blockedTableBody">
                        <!-- Blocked users will be loaded here -->
                    </tbody>
                </table>
                
                <div id="loadingBlocked" class="loading-spinner" style="display: none;">
                    <i class="fas fa-spinner"></i>
                    <p>ব্লকড ইউজার লোড হচ্ছে...</p>
                </div>
                
                <div id="noBlockedMessage" class="no-data" style="display: none;">
                    <i class="fas fa-user-check"></i>
                    <h3>কোনো ব্লকড ইউজার নেই</h3>
                    <p>সব ইউজার অ্যাক্টিভ আছেন</p>
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <div class="search-container">
                <div class="filter-options">
                    <button class="filter-btn active" data-analytics-filter="day">আজ</button>
                    <button class="filter-btn" data-analytics-filter="week">সপ্তাহ</button>
                    <button class="filter-btn" data-analytics-filter="month">মাস</button>
                    <button class="filter-btn" data-analytics-filter="year">বছর</button>
                </div>
            </div>
            
            <div class="user-table-container">
                <div id="analyticsContent">
                    <!-- Analytics will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS for Modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // User Management System
        class UserManagementSystem {
            constructor() {
                this.users = [];
                this.blockedUsers = [];
                this.selectedUser = null;
                this.currentFilter = 'all';
                this.init();
            }
            
            init() {
                // Check admin status first
                if (!checkAdminStatus()) {
                    return;
                }
                
                this.loadUsers();
                this.setupEventListeners();
                this.updateStats();
                this.renderUserTable();
                
                // Start block timer checker
                this.startBlockTimer();
            }
            
            loadUsers() {
                // Load users from localStorage
                const users = JSON.parse(localStorage.getItem('users')) || [];
                
                // Create demo users if none exist
                if (users.length === 0) {
                    this.createDemoUsers();
                    this.loadUsers(); // Reload after creating demo users
                    return;
                }
                
                // Process users
                this.users = users.map((user, index) => {
                    // Get today's date
                    const today = new Date().toDateString();
                    const joinDate = new Date(user.createdAt || Date.now()).toDateString();
                    
                    // Check if user is blocked
                    const isBlocked = user.blockedUntil && new Date(user.blockedUntil) > new Date();
                    
                    return {
                        ...user,
                        id: index + 1,
                        hash: `#${String(index + 1).padStart(3, '0')}`,
                        joinDate: new Date(user.createdAt || Date.now()).toLocaleDateString('bn-BD'),
                        joinTime: new Date(user.createdAt || Date.now()).toLocaleTimeString('bn-BD'),
                        isToday: today === joinDate,
                        balance: user.balance || 0,
                        status: isBlocked ? 'blocked' : (user.status || 'active'),
                        blockedUntil: user.blockedUntil || null,
                        blockReason: user.blockReason || null,
                        blockDays: user.blockDays || 0,
                        income: user.income || 0,
                        lastLogin: user.lastLogin || 'কখনো নয়',
                        totalReferrals: user.totalReferrals || 0
                    };
                });
                
                // Separate blocked users
                this.blockedUsers = this.users.filter(user => user.status === 'blocked');
                
                // Filter users based on current filter
                this.filterUsers();
            }
            
            createDemoUsers() {
                const demoUsers = [
                    {
                        username: "admin",
                        password: "admin123",
                        name: "এডমিন",
                        phone: "+880 1712345678",
                        email: "admin@advancebusiness.com",
                        referralId: "ADM001",
                        referredBy: null,
                        createdAt: new Date().toISOString(),
                        status: 'active',
                        balance: 50000,
                        income: 150000,
                        lastLogin: new Date().toLocaleString('bn-BD'),
                        totalReferrals: 25
                    },
                    {
                        username: "rahim123",
                        password: "pass1234",
                        name: "আব্দুর রহিম",
                        phone: "+880 1812345678",
                        email: "rahim@gmail.com",
                        referralId: "RHIM001",
                        referredBy: "ADM001",
                        createdAt: new Date(Date.now() - 86400000).toISOString(),
                        status: 'active',
                        balance: 12000,
                        income: 45000,
                        lastLogin: new Date().toLocaleString('bn-BD'),
                        totalReferrals: 8
                    },
                    {
                        username: "karim456",
                        password: "pass1234",
                        name: "করিম উদ্দিন",
                        phone: "+880 1912345678",
                        email: "karim@gmail.com",
                        referralId: "KRIM001",
                        referredBy: "ADM001",
                        createdAt: new Date().toISOString(),
                        status: 'active',
                        balance: 8000,
                        income: 28000,
                        lastLogin: new Date().toLocaleString('bn-BD'),
                        totalReferrals: 5
                    },
                    {
                        username: "sultana789",
                        password: "pass1234",
                        name: "সুলতানা বেগম",
                        phone: "+880 1612345678",
                        email: "sultana@gmail.com",
                        referralId: "SLTN001",
                        referredBy: "RHIM001",
                        createdAt: new Date(Date.now() - 172800000).toISOString(),
                        status: 'blocked',
                        blockedUntil: new Date(Date.now() + 3 * 86400000).toISOString(), // 3 days from now
                        blockReason: "সন্দেহজনক অ্যাক্টিভিটি",
                        blockDays: 7,
                        balance: 3000,
                        income: 12000,
                        lastLogin: new Date(Date.now() - 86400000).toLocaleString('bn-BD'),
                        totalReferrals: 2
                    },
                    {
                        username: "jamil000",
                        password: "pass1234",
                        name: "জামিল আহমেদ",
                        phone: "+880 1512345678",
                        email: "jamil@gmail.com",
                        referralId: "JML001",
                        referredBy: "KRIM001",
                        createdAt: new Date(Date.now() - 259200000).toISOString(),
                        status: 'active',
                        balance: 15000,
                        income: 65000,
                        lastLogin: new Date().toLocaleString('bn-BD'),
                        totalReferrals: 12
                    }
                ];
                
                localStorage.setItem('users', JSON.stringify(demoUsers));
            }
            
            setupEventListeners() {
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchUsers(e.target.value);
                });
                
                document.getElementById('blockedSearch').addEventListener('input', (e) => {
                    this.searchBlockedUsers(e.target.value);
                });
                
                // Tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.target.closest('.tab-btn').dataset.tab;
                        switchTab(tabName);
                    });
                });
                
                // Filter buttons for users
                document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn[data-filter]').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.filterUsers();
                    });
                });
                
                // Analytics filter buttons
                document.querySelectorAll('.filter-btn[data-analytics-filter]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn[data-analytics-filter]').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.target.classList.add('active');
                        this.showAnalytics(e.target.dataset.analyticsFilter);
                    });
                });
            }
            
            searchUsers(query) {
                const loadingMessage = document.getElementById('loadingUsers');
                loadingMessage.style.display = 'block';
                
                setTimeout(() => {
                    if (!query.trim()) {
                        this.filteredUsers = [...this.users];
                    } else {
                        const searchTerm = query.toLowerCase();
                        this.filteredUsers = this.users.filter(user => 
                            user.name.toLowerCase().includes(searchTerm) ||
                            user.username.toLowerCase().includes(searchTerm) ||
                            user.phone.includes(searchTerm) ||
                            user.email.toLowerCase().includes(searchTerm)
                        );
                    }
                    
                    this.renderUserTable();
                    loadingMessage.style.display = 'none';
                }, 300);
            }
            
            searchBlockedUsers(query) {
                const loadingMessage = document.getElementById('loadingBlocked');
                loadingMessage.style.display = 'block';
                
                setTimeout(() => {
                    if (!query.trim()) {
                        this.filteredBlockedUsers = [...this.blockedUsers];
                    } else {
                        const searchTerm = query.toLowerCase();
                        this.filteredBlockedUsers = this.blockedUsers.filter(user => 
                            user.name.toLowerCase().includes(searchTerm) ||
                            user.username.toLowerCase().includes(searchTerm) ||
                            user.phone.includes(searchTerm)
                        );
                    }
                    
                    this.renderBlockedTable();
                    loadingMessage.style.display = 'none';
                }, 300);
            }
            
            filterUsers() {
                let filtered = [...this.users];
                
                switch(this.currentFilter) {
                    case 'active':
                        filtered = filtered.filter(user => user.status === 'active');
                        break;
                    case 'today':
                        filtered = filtered.filter(user => user.isToday);
                        break;
                    case 'income':
                        filtered = filtered.sort((a, b) => b.income - a.income).slice(0, 10);
                        break;
                    // 'all' shows all users
                }
                
                this.filteredUsers = filtered;
                this.renderUserTable();
            }
            
            renderUserTable() {
                const tableBody = document.getElementById('userTableBody');
                const noUsersMessage = document.getElementById('noUsersMessage');
                const loadingMessage = document.getElementById('loadingUsers');
                
                tableBody.innerHTML = '';
                
                if (this.filteredUsers.length === 0) {
                    noUsersMessage.style.display = 'block';
                    loadingMessage.style.display = 'none';
                    return;
                }
                
                noUsersMessage.style.display = 'none';
                loadingMessage.style.display = 'none';
                
                this.filteredUsers.forEach((user) => {
                    const row = document.createElement('tr');
                    
                    // Status badge
                    let statusBadge = '';
                    if (user.status === 'active') {
                        statusBadge = '<span class="status-badge status-active">অ্যাক্টিভ</span>';
                    } else if (user.status === 'blocked') {
                        statusBadge = '<span class="status-badge status-blocked">ব্লকড</span>';
                    } else {
                        statusBadge = '<span class="status-badge status-pending">পেন্ডিং</span>';
                    }
                    
                    row.innerHTML = `
                        <td>
                            <div class="hash-tag">${user.hash.substring(1)}</div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">নাম</div>
                                <div class="user-info-value">${user.name}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">ইউজারনেম</div>
                                <div class="user-info-value">${user.username}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">মোবাইল</div>
                                <div class="user-info-value">${user.phone}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">ইমেইল</div>
                                <div class="user-info-value">${user.email}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">তারিখ</div>
                                <div class="user-info-value">${user.joinDate}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">ব্যালেন্স</div>
                                <div class="user-info-value">৳${user.balance.toLocaleString()}</div>
                            </div>
                        </td>
                        <td>
                            ${statusBadge}
                            ${user.status === 'blocked' ? 
                                `<div class="block-timer">
                                    <i class="fas fa-clock"></i>
                                    ${this.getRemainingTime(user.blockedUntil)}
                                </div>` : ''
                            }
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn ban-btn" onclick="userManagement.openBanModal('${user.username}')">
                                    <i class="fas fa-ban"></i> ব্লক
                                </button>
                                <button class="action-btn view-btn" onclick="userManagement.openViewModal('${user.username}')">
                                    <i class="fas fa-eye"></i> ভিউ
                                </button>
                                <button class="action-btn edit-btn" onclick="userManagement.openEditModal('${user.username}')">
                                    <i class="fas fa-edit"></i> এডিট
                                </button>
                                <button class="action-btn delete-btn" onclick="userManagement.openDeleteModal('${user.username}')">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            renderBlockedTable() {
                const tableBody = document.getElementById('blockedTableBody');
                const noBlockedMessage = document.getElementById('noBlockedMessage');
                const loadingMessage = document.getElementById('loadingBlocked');
                
                tableBody.innerHTML = '';
                
                if (this.filteredBlockedUsers.length === 0) {
                    noBlockedMessage.style.display = 'block';
                    loadingMessage.style.display = 'none';
                    return;
                }
                
                noBlockedMessage.style.display = 'none';
                loadingMessage.style.display = 'none';
                
                this.filteredBlockedUsers.forEach((user) => {
                    const row = document.createElement('tr');
                    
                    // Calculate block info
                    const blockDate = new Date(user.blockedUntil);
                    const now = new Date();
                    const remainingTime = this.getRemainingTime(user.blockedUntil);
                    
                    row.innerHTML = `
                        <td>
                            <div class="hash-tag">${user.hash.substring(1)}</div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">নাম</div>
                                <div class="user-info-value">${user.name}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">ইউজারনেম</div>
                                <div class="user-info-value">${user.username}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">মোবাইল</div>
                                <div class="user-info-value">${user.phone}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">ব্লক তারিখ</div>
                                <div class="user-info-value">${new Date(user.createdAt).toLocaleDateString('bn-BD')}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">মেয়াদ শেষ</div>
                                <div class="user-info-value">${remainingTime}</div>
                            </div>
                        </td>
                        <td>
                            <div class="user-info-cell">
                                <div class="user-info-label">কারণ</div>
                                <div class="user-info-value">${user.blockReason || 'নির্দিষ্ট কারণ নেই'}</div>
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="userManagement.unblockUser('${user.username}')">
                                    <i class="fas fa-unlock"></i> আনব্লক
                                </button>
                                <button class="action-btn view-btn" onclick="userManagement.openViewModal('${user.username}')">
                                    <i class="fas fa-eye"></i> ভিউ
                                </button>
                                <button class="action-btn delete-btn" onclick="userManagement.openDeleteModal('${user.username}')">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            updateStats() {
                const activeUsers = this.users.filter(user => user.status === 'active').length;
                const blockedUsers = this.users.filter(user => user.status === 'blocked').length;
                const totalIncome = this.users.reduce((sum, user) => sum + (user.income || 0), 0);
                
                document.getElementById('totalUsers').textContent = this.users.length;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('blockedUsers').textContent = blockedUsers;
                document.getElementById('totalIncome').textContent = `৳${totalIncome.toLocaleString()}`;
            }
            
            // ==================== BAN SYSTEM ====================
            
            openBanModal(username) {
                const user = this.users.find(u => u.username === username);
                if (!user) return;
                
                this.selectedUser = user;
                
                // Fill modal fields
                document.getElementById('banUsername').value = user.username;
                document.getElementById('banUserName').value = user.name;
                document.getElementById('banReason').value = user.blockReason || '';
                document.getElementById('banDays').value = user.blockDays || 7;
                
                // Show modal
                this.openModal('banModal');
            }
            
            confirmBan() {
                if (!this.selectedUser) return;
                
                const banDays = parseInt(document.getElementById('banDays').value) || 7;
                const banReason = document.getElementById('banReason').value || 'এডমিন কর্তৃক ব্লক করা হয়েছে';
                
                // Calculate block until date
                const now = new Date();
                const blockUntil = new Date(now.getTime() + (banDays * 86400000)); // Add days in milliseconds
                
                // Update user
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const userIndex = users.findIndex(u => u.username === this.selectedUser.username);
                
                if (userIndex !== -1) {
                    users[userIndex].status = 'blocked';
                    users[userIndex].blockedUntil = blockUntil.toISOString();
                    users[userIndex].blockReason = banReason;
                    users[userIndex].blockDays = banDays;
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Show success message
                    alert(`${this.selectedUser.name} (${this.selectedUser.username}) সফলভাবে ${banDays} দিনের জন্য ব্লক করা হয়েছে!`);
                    
                    // Reload and update
                    this.loadUsers();
                    this.updateStats();
                    this.renderUserTable();
                    
                    // Close modal
                    this.closeModal('banModal');
                }
            }
            
            unblockUser(username) {
                if (!confirm(`আপনি কি ${username} ইউজারকে আনব্লক করতে চান?`)) return;
                
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const userIndex = users.findIndex(u => u.username === username);
                
                if (userIndex !== -1) {
                    users[userIndex].status = 'active';
                    users[userIndex].blockedUntil = null;
                    users[userIndex].blockReason = null;
                    users[userIndex].blockDays = 0;
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    alert(`${username} ইউজার সফলভাবে আনব্লক করা হয়েছে!`);
                    
                    // Reload and update
                    this.loadUsers();
                    this.updateStats();
                    this.renderUserTable();
                    this.renderBlockedTable();
                }
            }
            
            // ==================== VIEW SYSTEM ====================
            
            openViewModal(username) {
                const user = this.users.find(u => u.username === username);
                if (!user) return;
                
                this.selectedUser = user;
                
                // Prepare user details HTML
                const detailsHTML = `
                    <div class="user-detail-item">
                        <div class="user-detail-label">পুরো নাম</div>
                        <div class="user-detail-value">${user.name}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">ইউজারনেম</div>
                        <div class="user-detail-value">${user.username}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">মোবাইল নম্বর</div>
                        <div class="user-detail-value">${user.phone}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">ইমেইল</div>
                        <div class="user-detail-value">${user.email}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">পাসওয়ার্ড</div>
                        <div class="user-detail-value">${user.password}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">জয়েন তারিখ</div>
                        <div class="user-detail-value">${user.joinDate}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">লাস্ট লগইন</div>
                        <div class="user-detail-value">${user.lastLogin}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">ব্যালেন্স</div>
                        <div class="user-detail-value">৳${user.balance.toLocaleString()}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">মোট ইনকাম</div>
                        <div class="user-detail-value">৳${user.income.toLocaleString()}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">মোট রেফারেন্স</div>
                        <div class="user-detail-value">${user.totalReferrals} জন</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">স্ট্যাটাস</div>
                        <div class="user-detail-value">
                            ${user.status === 'active' ? 'অ্যাক্টিভ' : 'ব্লকড'}
                            ${user.status === 'blocked' ? `<br><small>কারণ: ${user.blockReason || 'নির্দিষ্ট কারণ নেই'}</small>` : ''}
                        </div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">রেফারেন্স আইডি</div>
                        <div class="user-detail-value">${user.referralId || 'নেই'}</div>
                    </div>
                    <div class="user-detail-item">
                        <div class="user-detail-label">রেফারার</div>
                        <div class="user-detail-value">${user.referredBy || 'নেই'}</div>
                    </div>
                `;
                
                // Insert into modal
                document.getElementById('userDetailsGrid').innerHTML = detailsHTML;
                
                // Show modal
                this.openModal('viewModal');
            }
            
            // ==================== EDIT SYSTEM ====================
            
            openEditModal(username) {
                const user = this.users.find(u => u.username === username);
                if (!user) return;
                
                this.selectedUser = user;
                
                // Fill modal fields
                document.getElementById('editName').value = user.name;
                document.getElementById('editUsername').value = user.username;
                document.getElementById('editPhone').value = user.phone;
                document.getElementById('editEmail').value = user.email;
                document.getElementById('editPassword').value = user.password;
                document.getElementById('editBalance').value = user.balance || 0;
                
                // Show modal
                this.openModal('editModal');
            }
            
            confirmEdit() {
                if (!this.selectedUser) return;
                
                const name = document.getElementById('editName').value.trim();
                const phone = document.getElementById('editPhone').value.trim();
                const email = document.getElementById('editEmail').value.trim();
                const password = document.getElementById('editPassword').value;
                const balance = parseFloat(document.getElementById('editBalance').value) || 0;
                
                // Validation
                if (!name || !phone || !email || !password) {
                    alert('সব প্রয়োজনীয় ফিল্ড পূরণ করুন!');
                    return;
                }
                
                // Update user
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const userIndex = users.findIndex(u => u.username === this.selectedUser.username);
                
                if (userIndex !== -1) {
                    users[userIndex].name = name;
                    users[userIndex].phone = phone;
                    users[userIndex].email = email;
                    users[userIndex].password = password;
                    users[userIndex].balance = balance;
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    alert('ইউজার তথ্য সফলভাবে আপডেট করা হয়েছে!');
                    
                    // Reload and update
                    this.loadUsers();
                    this.updateStats();
                    this.renderUserTable();
                    
                    // Close modal
                    this.closeModal('editModal');
                }
            }
            
            // ==================== DELETE SYSTEM ====================
            
            openDeleteModal(username) {
                const user = this.users.find(u => u.username === username);
                if (!user) return;
                
                this.selectedUser = user;
                
                // Fill modal fields
                document.getElementById('deleteUsername').value = user.username;
                document.getElementById('deleteUserName').value = user.name;
                document.getElementById('deleteReason').value = '';
                
                // Show modal
                this.openModal('deleteModal');
            }
            
            confirmDelete() {
                if (!this.selectedUser) return;
                
                const deleteReason = document.getElementById('deleteReason').value || 'এডমিন কর্তৃক ডিলিট করা হয়েছে';
                
                if (!confirm(`আপনি কি নিশ্চিত যে ${this.selectedUser.name} (${this.selectedUser.username}) ইউজারকে ডিলিট করতে চান?\n\nএই একশন রিভার্স করা যাবে না!`)) {
                    return;
                }
                
                // Delete user
                let users = JSON.parse(localStorage.getItem('users')) || [];
                users = users.filter(u => u.username !== this.selectedUser.username);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Log deletion
                const deletions = JSON.parse(localStorage.getItem('user_deletions')) || [];
                deletions.push({
                    username: this.selectedUser.username,
                    name: this.selectedUser.name,
                    deletedAt: new Date().toISOString(),
                    reason: deleteReason
                });
                localStorage.setItem('user_deletions', JSON.stringify(deletions));
                
                alert(`${this.selectedUser.name} (${this.selectedUser.username}) ইউজার সফলভাবে ডিলিট করা হয়েছে!`);
                
                // Clear selection
                this.selectedUser = null;
                
                // Reload and update
                this.loadUsers();
                this.updateStats();
                this.renderUserTable();
                this.renderBlockedTable();
                
                // Close modal
                this.closeModal('deleteModal');
            }
            
            // ==================== BLOCK TIMER SYSTEM ====================
            
            getRemainingTime(blockedUntil) {
                if (!blockedUntil) return 'অনির্দিষ্ট';
                
                const now = new Date();
                const blockDate = new Date(blockedUntil);
                const diffMs = blockDate - now;
                
                if (diffMs <= 0) return 'সময় শেষ';
                
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                return `${diffDays} দিন ${diffHours} ঘণ্টা`;
            }
            
            startBlockTimer() {
                // Check every minute for expired blocks
                setInterval(() => {
                    this.checkExpiredBlocks();
                }, 60000); // 1 minute
            }
            
            checkExpiredBlocks() {
                const users = JSON.parse(localStorage.getItem('users')) || [];
                let updated = false;
                const now = new Date();
                
                users.forEach(user => {
                    if (user.status === 'blocked' && user.blockedUntil) {
                        const blockDate = new Date(user.blockedUntil);
                        if (blockDate <= now) {
                            // Auto unblock
                            user.status = 'active';
                            user.blockedUntil = null;
                            user.blockReason = null;
                            user.blockDays = 0;
                            updated = true;
                            
                            console.log(`${user.username} স্বয়ংক্রিয়ভাবে আনব্লক হয়েছে`);
                        }
                    }
                });
                
                if (updated) {
                    localStorage.setItem('users', JSON.stringify(users));
                    this.loadUsers();
                    this.updateStats();
                    this.renderUserTable();
                    this.renderBlockedTable();
                }
            }
            
            // ==================== ANALYTICS SYSTEM ====================
            
            showAnalytics(filter) {
                const analyticsContent = document.getElementById('analyticsContent');
                
                // Calculate analytics based on filter
                let analyticsData = {};
                
                switch(filter) {
                    case 'day':
                        analyticsData = this.getDailyAnalytics();
                        break;
                    case 'week':
                        analyticsData = this.getWeeklyAnalytics();
                        break;
                    case 'month':
                        analyticsData = this.getMonthlyAnalytics();
                        break;
                    case 'year':
                        analyticsData = this.getYearlyAnalytics();
                        break;
                }
                
                // Display analytics
                analyticsContent.innerHTML = this.generateAnalyticsHTML(analyticsData, filter);
            }
            
            getDailyAnalytics() {
                const today = new Date().toDateString();
                const todayUsers = this.users.filter(user => 
                    new Date(user.createdAt).toDateString() === today
                );
                
                return {
                    title: 'আজকের রিপোর্ট',
                    newUsers: todayUsers.length,
                    totalIncome: todayUsers.reduce((sum, user) => sum + (user.income || 0), 0),
                    topUser: todayUsers.sort((a, b) => b.income - a.income)[0]
                };
            }
            
            getWeeklyAnalytics() {
                const weekAgo = new Date(Date.now() - 7 * 86400000);
                const weeklyUsers = this.users.filter(user => 
                    new Date(user.createdAt) >= weekAgo
                );
                
                return {
                    title: 'সাপ্তাহিক রিপোর্ট',
                    newUsers: weeklyUsers.length,
                    totalIncome: weeklyUsers.reduce((sum, user) => sum + (user.income || 0), 0),
                    topUser: weeklyUsers.sort((a, b) => b.income - a.income)[0]
                };
            }
            
            getMonthlyAnalytics() {
                const monthAgo = new Date(Date.now() - 30 * 86400000);
                const monthlyUsers = this.users.filter(user => 
                    new Date(user.createdAt) >= monthAgo
                );
                
                return {
                    title: 'মাসিক রিপোর্ট',
                    newUsers: monthlyUsers.length,
                    totalIncome: monthlyUsers.reduce((sum, user) => sum + (user.income || 0), 0),
                    topUser: monthlyUsers.sort((a, b) => b.income - a.income)[0]
                };
            }
            
            getYearlyAnalytics() {
                const yearAgo = new Date(Date.now() - 365 * 86400000);
                const yearlyUsers = this.users.filter(user => 
                    new Date(user.createdAt) >= yearAgo
                );
                
                return {
                    title: 'বার্ষিক রিপোর্ট',
                    newUsers: yearlyUsers.length,
                    totalIncome: yearlyUsers.reduce((sum, user) => sum + (user.income || 0), 0),
                    topUser: yearlyUsers.sort((a, b) => b.income - a.income)[0]
                };
            }
            
            generateAnalyticsHTML(data, filter) {
                return `
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #ff8c00; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-chart-bar"></i> ${data.title}
                        </h3>
                        
                        <div class="analytics-cards">
                            <div class="analytics-card" style="border-left-color: #28a745;">
                                <h4>নতুন ইউজার</h4>
                                <div class="analytics-value" style="color: #28a745;">${data.newUsers}</div>
                                <div class="analytics-label">${filter} অনুযায়ী</div>
                            </div>
                            
                            <div class="analytics-card" style="border-left-color: #007bff;">
                                <h4>মোট ইনকাম</h4>
                                <div class="analytics-value" style="color: #007bff;">৳${data.totalIncome.toLocaleString()}</div>
                                <div class="analytics-label">${filter} অনুযায়ী</div>
                            </div>
                            
                            <div class="analytics-card" style="border-left-color: #ff8c00;">
                                <h4>টপ ইনকামকারী</h4>
                                ${data.topUser ? `
                                    <div class="analytics-value" style="color: #ff8c00;">${data.topUser.name}</div>
                                    <div class="analytics-label">৳${data.topUser.income.toLocaleString()}</div>
                                ` : '<div class="analytics-label" style="color: #666;">কোনো ডেটা নেই</div>'}
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h4 style="color: #333; margin-bottom: 15px;">ইনকাম চার্ট (টপ 10 ইউজার)</h4>
                            <div id="incomeChart" style="height: 300px; background: #f8f9fa; border-radius: 10px; padding: 20px;">
                                ${this.generateIncomeChart()}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            generateIncomeChart() {
                // Sort users by income and take top 10
                const topUsers = [...this.users]
                    .sort((a, b) => b.income - a.income)
                    .slice(0, 10);
                
                if (topUsers.length === 0) {
                    return '<p style="text-align: center; color: #666; padding: 50px;">কোনো ডেটা নেই</p>';
                }
                
                // Generate simple HTML chart
                let chartHTML = '<div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">';
                
                topUsers.forEach((user, index) => {
                    const maxIncome = topUsers[0].income;
                    const barWidth = (user.income / maxIncome) * 100;
                    
                    chartHTML += `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; font-weight: bold; color: #333;">${index + 1}</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-size: 14px; color: #333;">${user.name}</span>
                                    <span style="font-size: 14px; font-weight: bold; color: #ff8c00;">৳${user.income.toLocaleString()}</span>
                                </div>
                                <div style="height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden;">
                                    <div style="height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, #ff8c00, #ff6b00); border-radius: 10px;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                chartHTML += '</div>';
                return chartHTML;
            }
            
            // ==================== MODAL HELPERS ====================
            
            openModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            }
            
            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }
        }
        
        // Admin Check Function
        function checkAdminStatus() {
            const isAdmin = sessionStorage.getItem('isAdmin');
            const adminCheckOverlay = document.getElementById('adminCheckOverlay');
            
            if (!isAdmin || isAdmin !== 'true') {
                if (adminCheckOverlay) {
                    adminCheckOverlay.style.display = 'flex';
                }
                return false;
            } else {
                if (adminCheckOverlay) {
                    adminCheckOverlay.style.display = 'none';
                }
                return true;
            }
        }
        
        // Redirect functions
        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }
        
        function goToLogin() {
            window.location.href = 'login.html';
        }
        
        // Tab Switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Activate corresponding tab button
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            
            // Load tab data
            if (tabName === 'blocked') {
                userManagement.loadUsers();
                userManagement.renderBlockedTable();
            } else if (tabName === 'analytics') {
                userManagement.showAnalytics('day');
            }
        }
        
        // Modal close functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Initialize when page loads
        let userManagement;
        document.addEventListener('DOMContentLoaded', function() {
            // Check admin status first
            if (checkAdminStatus()) {
                userManagement = new UserManagementSystem();
            }
        });
        
        // Make functions available globally
        window.userManagement = userManagement;
        window.switchTab = switchTab;
        window.closeModal = closeModal;
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (checkAdminStatus() && userManagement) {
                userManagement.loadUsers();
                userManagement.updateStats();
            }
        }, 30000);
    </script>
</body>
</html>